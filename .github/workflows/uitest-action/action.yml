name: "Execute UI Tests"
description: "Executes all ui tests"
inputs:
  nexus_user:
    description: 'Nexus Username'
    required: true
  nexus_password:
    description: 'Nexus Password'
    required: true

runs:
  using: "composite"
  steps:
  
    # Build vorbereiten
    - name: Prepare Maven Build
      uses: ./.github/workflows/prepare-action
      with:
        nexus_user: ${{ inputs.nexus_user }}
        nexus_password: ${{ inputs.nexus_password }}
    
    
    - name: install qfs linux
      if: runner.os == 'Linux'
      working-directory: ./QF-Test/lin
      shell: bash
      run:  |
        tar xzvf qftest.tar.gz
        cd qftest/qftest-6.0.4
        printf 'y\ny\n1024\ng\n' | ./setup
    
    
    - name: install qfs macos
      if: runner.os == 'macOS'
      working-directory: ./QF-Test/lin
      shell: bash
      run:  |
        sudo hdiutil attach qftest.dmg
        sudo cp -R /Volumes/qftest ${{ github.workspace }}/QF-Test/lin
        sudo hdiutil unmount /Volumes/qftest/
    
    
    - name: ADITOdesigner.conf (win)
      if: runner.os == 'Windows'
      shell: pwsh
      run: (Get-Content QF-Test\ADITOdesigner.conf) | % {
             $_ -replace [regex]::escape('${installer:adito.installer.scaleui}'), '${{ env.scaleuiwin }}' `
                -replace [regex]::escape('${adito.complete.final.version}'), '${{ env.fullVersion }}' `
                -replace 'jdkhome="jre"', 'jdkhome="${{ env.JAVA_HOME }}"' `
                -replace [regex]::escape('${installer:adito.installer.basepath}/lib/designer'), '${{ github.workspace }}/application/designer/target/aditodesigner' `
                -replace [regex]::escape('${installer:adito.installer.basepath}'), '${{ github.workspace }}' `
             } | Set-Content QF-Test\ADITOdesigner.conf; `
             Move-Item -Path QF-Test/ADITOdesigner.conf -Destination application\designer\target\aditodesigner\etc -Force; `
             Get-Content -Path application\designer\target\aditodesigner\etc\ADITOdesigner.conf
      env:
        scaleuiwin: '-J-Dsun.java2d.dpiaware=true'
        fullVersion: '1234.5.6.7'
    
    
    - name: ADITOdesigner.conf (lin)
      if: runner.os == 'Linux'
      shell: bash
      run:  |
        sed -i 's/\${installer:adito.installer.scaleui}/${{ env.scaleuilin }}/g' QF-Test/ADITOdesigner.conf
        sed -i 's/\${adito.complete.final.version}/${{ env.fullVersion }}/g' QF-Test/ADITOdesigner.conf
        sed -i 's!jdkhome="jre"!jdkhome="${{ env.JAVA_HOME }}"!g' QF-Test/ADITOdesigner.conf
        sed -i 's!\${installer:adito.installer.basepath}/lib/designer!${{ github.workspace }}/application/designer/target/aditodesigner!g' QF-Test/ADITOdesigner.conf
        sed -i 's!\${installer:adito.installer.basepath}!${{ github.workspace }}!g' QF-Test/ADITOdesigner.conf
        mv -f QF-Test/ADITOdesigner.conf application/designer/target/aditodesigner/etc
        cat application/designer/target/aditodesigner/etc/ADITOdesigner.conf
      env:
        scaleuilin: ''
        fullVersion: '1234.5.6.7'
    
    
    # does max need scaleui? currently empty
    - name: ADITOdesigner.conf (mac) 
      if: runner.os == 'macOS'
      shell: bash
      run:  |
        sed -i '' 's/\${installer:adito.installer.scaleui}/${{ env.scaleuimac }}/g' QF-Test/ADITOdesigner.conf
        sed -i '' 's/\${adito.complete.final.version}/${{ env.fullVersion }}/g' QF-Test/ADITOdesigner.conf
        sed -i '' 's!jdkhome="jre"!jdkhome="${{ env.JAVA_HOME }}"!g' QF-Test/ADITOdesigner.conf
        sed -i '' 's!\${installer:adito.installer.basepath}/lib/designer!${{ github.workspace }}/application/designer/target/aditodesigner!g' QF-Test/ADITOdesigner.conf
        sed -i '' 's!\${installer:adito.installer.basepath}!${{ github.workspace }}!g' QF-Test/ADITOdesigner.conf
        mv -f QF-Test/ADITOdesigner.conf application/designer/target/aditodesigner/etc
        cat application/designer/target/aditodesigner/etc/ADITOdesigner.conf
      env:
        scaleuimac: ''
        fullVersion: '1234.5.6.7'
    
    
    # UITests ausfï¿½hren
    - name: UI Tests windows
      if: runner.os == 'Windows'
      working-directory: ./QF-Test/win
      shell: bash
      run: qftest-6.0.4/bin/qftestc.exe -batch -nomessagewindow -verbose -run qftest-6.0.4/demo/carconfig/carconfig_de.qft
    
    - name: UI Tests linux
      if: runner.os == 'Linux'
      working-directory: ./QF-Test/lin
      shell: bash
      run: qftest-6.0.4/bin/qftest -batch -nomessagewindow -verbose -run qftest-6.0.4/demo/carconfig/carconfig_de.qft
    
    - name: UI Tests macos
      if: runner.os == 'macOS'
      working-directory: ./QF-Test/mac
      shell: bash
      run: qftest-6.0.4/bin/qftest -batch -nomessagewindow -verbose -run qftest-6.0.4/demo/carconfig/carconfig_de.qft
    
    
    
